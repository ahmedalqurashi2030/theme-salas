{#
| Variable         | Type    | Description                     |
|------------------|---------|---------------------------------|
| cart             | object  |                                 |
| cart.items_count | int     |                                 |
| cart.total       | string  | Formatted total ex: "١٠٠ ر.س"   |
#}
<header
	class="store-header sx-aliexpress-header">
	{# 1. Top Navbar (Mini Bar) #}
	<div class="ali-top-navbar top-navbar">
		<div class="container flex justify-between">
			<div
				class="flex items-center space-x-4 rtl:space-x-reverse">
				{# Footer Menu (often used for Help/About in top bar) #}
				{% component 'footer.menu' with {is_header:true} %}

				{% if store.settings.is_multilingual or store.settings.currencies_enabled %}
					<button type="button" onclick="salla.event.dispatch('localization::open')" class="ali-top-btn btn--rounded-gray">
						<span class="flag iti__flag iti__{{ user.language.country_code }} rounded-sm"></span>
						<span class="mx-1.5">|</span>
						<span>{{ currency.symbol }}</span>
					</button>
					<salla-localization-modal></salla-localization-modal>
				{% endif %}

				{% if store.scope %}
					<button class="ali-top-btn btn--rounded-gray" onclick="salla.event.dispatch('scopes::open', {'mode': 'default'})">
						<i class="sicon-location rtl:ml-1 ltr:mr-1"></i>
						{{ store.scope.name }}
					</button>
				{% endif %}
			</div>
			{# Optional Contact Info #}
			{% component 'footer.contacts' with {is_header:true} %}
		</div>
	</div>

	{# 2. Main Header Row (Logo | Search | Actions) #}
	<div class="ali-main-header">
		<div class="container">
			<div
				class="ali-main-row flex items-center justify-between">
				{# Logo Area #}
				<div class="ali-logo-area flex items-center">
					<a class="lg:hidden mburger mburger--collapse leading-none rtl:ml-4 ltr:mr-4" href="#mobile-menu">
						<i class="sicon-menu text-2xl"></i>
					</a>
					<a class="navbar-brand" href="{{ store.url }}">
						<img fetchpriority="high" width="100%" height="100%" loading="eager" src="{{ store.logo }}" alt="{{ store.name }}">
					</a>
				</div>

				{# Search Area (Moved here) #}
				<div class="ali-search-area flex-1 mx-8 hidden lg:block">
					<salla-search inline oval height="40"></salla-search>
				</div>

				{# Actions Area #}
				<div class="ali-actions-area flex items-center justify-end space-x-6 rtl:space-x-reverse">
					{% if user.type=='user' %}
						<salla-user-menu avatar-only show-header></salla-user-menu>
					{% else %}
						<button class="ali-action-btn header-btn" onclick="salla.event.dispatch('login::open')">
							<i class="header-btn__icon sicon-user-circle"></i>
							<span class="ali-btn-label hidden lg:block">{{ trans('blocks.header.login') }}</span>
						</button>
					{% endif %}

					<salla-cart-summary class="ali-cart-btn">
						<i slot="icon" class="header-btn__icon icon sicon-shopping-bag"></i>
					</salla-cart-summary>
				</div>
			</div>

			{# Mobile Search (Visible only on mobile) #}
			<div class="ali-mobile-search lg:hidden mt-3 pb-3">
				<salla-search inline oval height="36"></salla-search>
			</div>
		</div>
	</div>

	{# 3. Navigation Bar (Categories | Menu) #}
	<div id="mainnav" class="ali-nav-bar hidden lg:block">
		<div class="container">
			<div
				class="flex items-center">
				{# "All Categories" Button & Dropdown (Desktop Logic) #}
				<div id="ali-category-trigger" class="ali-all-cats relative group">
					<button class="ali-cat-btn" type="button" onclick="toggleAliSidebar()">
						<i class="sicon-menu"></i>
						<span>كل الأصناف</span>
						<i class="sicon-keyboard_arrow_down text-xs opacity-50 transition-transform duration-300 transform group-[.is-active]:rotate-180"></i>
					</button>

					{# Sidebar Dropdown (Desktop Custom Loop) #}
					<div id="ali-cat-dropdown" class="ali-cat-dropdown">
						<ul
							class="main-menu custom-ali-list">
							{# Use core Salla variable for menus #}
							{% for item in menus.main_menu.items %}
								<li>
									<a href="{{ item.url }}" class="flex items-center gap-3">
										{% if item.image %}
											<img src="{{ item.image }}" class="w-6 h-6 object-contain rounded-full" alt="{{ item.title }}">
										{% endif %}
										<span>{{ item.title }}</span>
										{% if item.children|length > 0 %}
											<i class="sicon-keyboard_arrow_left ltr:rotate-180 text-xs text-gray-400 ms-auto"></i>
										{% endif %}
									</a>

									{# Mega Menu / Submenu #}
									{% if item.children|length > 0 %}
										<ul class="sub-menu">
											{% for sub in item.children %}
												<li>
													<a href="{{ sub.url }}">{{ sub.title }}</a>
													{# Level 3 if needed #}
												</li>
											{% endfor %}

											{# Optional Products in Mega Menu #}
											{# If Salla provides products in menu item #}
										</ul>
									{% endif %}
								</li>
							{% endfor %}
						</ul>
					</div>
				</div>

				{# Backdrop Overlay #}
				<div id="ali-backdrop" class="ali-backdrop" onclick="closeAliSidebar()"></div>

				{# Horizontal Menu (Optional) #}
				<div class="ali-menu-wrapper flex-1 hidden md:block"></div>
			</div>
		</div>
	</div>

	{# 4. Mobile Menu Component (Hidden on Desktop) #}
	{# This ensures the Offcanvas works on mobile without polluting desktop markup #}
	<div class="hidden">
		{% component 'header.menu' %}
	</div>

	{# Custom Script for AliExpress Sidebar Toggle #}
	<script>
		function toggleAliSidebar() {
var trigger = document.getElementById('ali-category-trigger');
var backdrop = document.getElementById('ali-backdrop');
var isMobile = window.innerWidth < 1024;

if (isMobile) { // Mobile: Use Salla default drawer event or selector
salla.event.dispatch('mobile-menu::open');
// Or fallback to direct DOM manipulation if event not standard
var mobileMenu = document.querySelector('#mobile-menu');
if (mobileMenu) 
mobileMenu.classList.add('is-open');

} else { // Desktop: Toggle Dropdown & Backdrop
if (trigger) 
trigger.classList.toggle('is-active');

if (backdrop) 
backdrop.classList.toggle('is-visible');

}
}

function closeAliSidebar() {
var trigger = document.getElementById('ali-category-trigger');
var backdrop = document.getElementById('ali-backdrop');
if (trigger) 
trigger.classList.remove('is-active');

if (backdrop) 
backdrop.classList.remove('is-visible');

}

document.addEventListener('keydown', function (event) {
if (event.key === "Escape") 
closeAliSidebar();

});
	</script>
</header>
{% if store.scope %}
	<salla-scopes selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"></salla-scopes>
{% endif %}
