{#
| Variable         | Type    | Description                     |
|------------------|---------|---------------------------------|
| cart             | object  |                                 |
| cart.items_count | int     |                                 |
| cart.total       | string  | Formatted total ex: "١٠٠ ر.س"   |
#}
{% set important_links = theme.settings.get('important_links') %}

<header class="store-header tharaa-header">
  
  {# Row 1: Top Bar (Utilities) #}
  <div class="top-bar hidden lg:block">
    <div class="container flex justify-between items-center h-full">
      <div class="flex items-center gap-4">
        {# Language & Currency #}
        {% if store.settings.is_multilingual or store.settings.currencies_enabled %}
          <button type="button" onclick="salla.event.dispatch('localization::open')" class="top-bar__btn">
            <span class="flag iti__flag iti__{{ user.language.country_code }} rounded-sm"></span>
            <span class="mx-1.5 text-xs">{{ currency.symbol }}</span>
            <i class="sicon-keyboard-arrow-down text-xs"></i>
          </button>
          <salla-localization-modal></salla-localization-modal>
        {% endif %}
        
        {# Scopes #}
        {% if store.scope %}
            <button class="top-bar__btn" onclick="salla.event.dispatch('scopes::open', {'mode': 'default'})">
                <i class="sicon-location text-xs"></i> 
                <span class="text-xs">{{ store.scope.name }}</span>
            </button>
        {% endif %}
      </div>

      <div class="flex items-center gap-4">
         {% if important_links %}
            <salla-menu source="footer" topnav></salla-menu>
         {% endif %}
      </div>
    </div>
  </div>

  {# Row 2: Main Header (Logo, Search, Actions) #}
  <div class="main-header py-4 bg-white shadow-sm relative z-20">
    <div class="container flex items-center justify-between gap-8">
      
      {# Logo #}
      <a class="navbar-brand shrink-0" href="{{ store.url }}">
          <img fetchpriority="high" width="100%" height="100%" loading="eager" src="{{ store.logo }}" alt="{{ store.name }} logo" class="max-h-12 object-contain">
          {% if is_page('index') %}
            <h1 class="sr-only">{{ store.name }}</h1>
          {% else %}
            <h2 class="sr-only">{{ store.name }}</h2>
          {% endif %}
      </a>

      {# Search Bar (Central & Wide) #}
      <div class="header-search flex-1 max-w-2xl hidden lg:block">
        <salla-search inline oval height="42" class="w-full"></salla-search>
      </div>

      {# User Actions #}
      <div class="header-actions flex items-center gap-2 lg:gap-6">
        
        {# Mobile Menu Toggle #}
        <a class="lg:hidden mburger mburger--collapse leading-none" href="#mobile-menu" aria-label="Open-menu">
          <i class="sicon-menu text-primary text-2xl"></i>
        </a>

        {# Search Toggle (Mobile) #}
        <button class="lg:hidden header-btn" onclick="salla.event.dispatch('search::open')">
            <i class="sicon-search text-xl"></i>
        </button>

        {# User Profile #}
        <div class="hidden lg:block relative group">
            {% if user.type=='user' %}
                <salla-user-menu avatar-only show-header></salla-user-menu>
            {% else %}
                <button class="header-action-btn flex flex-col items-center gap-1" onclick="salla.event.dispatch('login::open')">
                    <i class="sicon-user text-2xl text-gray-600"></i>
                    <span class="text-xs text-gray-500">{{ trans('blocks.header.login') }}</span>
                </button>
            {% endif %}
        </div>

        {# Cart #}
        <salla-cart-summary class="header-action-btn flex flex-col items-center gap-1">
            <div class="relative">
                <i slot="icon" class="sicon-shopping-bag text-2xl text-gray-600"></i>
                <span class="badge-count absolute -top-1 -right-1 bg-red-500 text-white text-[10px] rounded-full h-4 w-4 flex items-center justify-center">{{ cart.items_count }}</span>
            </div>
            <span class="text-xs text-gray-500 hidden lg:block">{{ trans('blocks.header.cart') }}</span>
        </salla-cart-summary>

      </div>
    </div>
  </div>

  {# Row 3: Nav Bar (Categories) #}
  <div id="mainnav" class="nav-bar bg-white border-t border-gray-100 hidden lg:block">
      <div class="container">
          <div class="flex items-center">
              {# All Categories Dropdown Trigger (Optional - can be part of menu) #}
              
              {# Main Menu #}
              <custom-main-menu></custom-main-menu>
          </div>
      </div>
  </div>

</header>

{% if store.scope %}
    <salla-scopes selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"></salla-scopes>
{% endif %}
