{#
| Variable         | Type    | Description                     |
|------------------|---------|---------------------------------|
| cart             | object  |                                 |
| cart.items_count | int     |                                 |
| cart.total       | string  | Formatted total ex: "١٠٠ ر.س"   |
#}

<header class="store-header th-header">

    {# 1. الشريط العلوي (Top Bar) #}
    <div class="th-topbar">
        <div class="container flex justify-between items-center h-full">
            <div class="flex items-center gap-4">
                {# القائمة العلوية (روابط الفوتر) #}
                {% component 'footer.menu' with {is_header:true} %}
                
                {# العملة واللغة #}
                {% if store.settings.is_multilingual or store.settings.currencies_enabled %}
                    <button type="button" onclick="salla.event.dispatch('localization::open')" class="th-topbtn">
                        <span class="flag iti__flag iti__{{ user.language.country_code }}"></span>
                        <span class="mx-1">|</span> <span>{{ currency.symbol }}</span>
                    </button>
                    <salla-localization-modal></salla-localization-modal>
                {% endif %}
            </div>

            {# نص ترويجي أو روابط التواصل #}
            <div class="hidden md:block text-xs opacity-90">
                شحن مجاني للطلبات التي تزيد عن 299 ريال
            </div>
        </div>
    </div>

    {# 2. الهيدر الأوسط (Main Header) #}
    <div class="th-main-header bg-white sticky top-0 z-30 shadow-sm">
        <div class="container">
            <div class="flex items-center justify-between gap-6 py-3">
                
                {# زر الموبايل #}
                <a class="lg:hidden text-2xl text-gray-800" href="#mobile-menu">
                    <i class="sicon-menu"></i>
                </a>

                {# الشعار #}
                <a class="th-logo" href="{{ store.url }}">
                    <img src="{{ store.logo }}" alt="{{ store.name }}">
                    <h1 class="sr-only">{{ store.name }}</h1>
                </a>

                {# البحث (يظهر فقط في الكمبيوتر) #}
                <div class="flex-1 max-w-2xl hidden lg:block">
                    <salla-search inline oval height="42" placeholder="{{ trans('blocks.header.search_placeholder') }}"></salla-search>
                </div>

                {# الأيقونات #}
                <div class="flex items-center gap-4">
                    {# زر بحث للموبايل #}
                    <button class="lg:hidden text-xl" onclick="salla.event.dispatch('search::open')">
                        <i class="sicon-search"></i>
                    </button>

                    {# تسجيل الدخول #}
                    <div class="hidden lg:block">
                        <salla-user-menu avatar-only show-header></salla-user-menu>
                    </div>
                    <button class="lg:hidden text-xl" onclick="salla.event.dispatch('login::open')">
                        <i class="sicon-user"></i>
                    </button>

                    {# السلة #}
                    <salla-cart-summary class="th-cart-btn">
                        <div slot="icon" class="relative">
                            <i class="sicon-shopping-bag text-2xl"></i>
                            <span class="th-badge">{{ cart.items_count }}</span>
                        </div>
                    </salla-cart-summary>
                </div>
            </div>
        </div>
    </div>

    {# 3. شريط القوائم (Navigation Bar) #}
    <div class="th-navbar bg-white border-t border-gray-100 hidden lg:block">
        <div class="container">
            {% component 'header.menu' %}
        </div>
    </div>

</header>

{# استدعاء المودالز #}
{% if store.scope %}
    <salla-scopes selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"></salla-scopes>
{% endif %}



<style>
  /* --- متغيرات الألوان --- */
:root {
    --color-gold: #d4af37;
    --color-dark: #222;
    --color-gray-light: #f9f9f9;
}

/* --- تنسيقات الهيدر العامة --- */
.th-header {
    font-family: 'Tajawal', sans-serif; /* تأكد من وجود الخط */
}

.th-topbar {
    background-color: var(--color-dark);
    color: #fff;
    font-size: 12px;
    padding: 8px 0;
}

.th-topbtn {
    display: flex;
    align-items: center;
    opacity: 0.8;
    transition: 0.3s;
}
.th-topbtn:hover { opacity: 1; }

.th-logo img {
    height: 45px;
    width: auto;
}

/* --- زر السلة --- */
.th-cart-btn {
    position: relative;
    cursor: pointer;
}
.th-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: var(--color-gold);
    color: #fff;
    font-size: 10px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
}

/* --- الناف بار وزر جميع الأقسام --- */
.th-navbar {
    height: 55px;
    position: relative;
    z-index: 20; /* أقل من الهيدر المثبت */
}

.th-nav-container {
    height: 100%;
}

.th-all-cats-wrapper {
    height: 100%;
    position: relative;
}

.th-all-cats-btn {
    height: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 0 20px;
    background-color: var(--color-gray-light);
    border-left: 1px solid #eee;
    border-right: 1px solid #eee;
    cursor: pointer;
    font-weight: 800;
    font-size: 14px;
    color: var(--color-dark);
    transition: 0.3s;
    width: 200px; /* عرض ثابت للجمالية */
}

.th-all-cats-wrapper:hover .th-all-cats-btn {
    background-color: var(--color-gold);
    color: #fff;
}

/* --- الميجا منيو (Mega Menu) --- */
.th-mega-menu {
    position: absolute;
    top: 100%;
    right: 0;
    width: 900px;
    background: #fff;
    border: 1px solid #eee;
    box-shadow: 0 15px 40px rgba(0,0,0,0.1);
    border-radius: 0 0 8px 8px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.3s ease;
    z-index: 100;
    min-height: 400px;
}

.th-all-cats-wrapper:hover .th-mega-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.th-mega-tab {
    padding: 12px 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    color: #555;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #f0f0f0;
    transition: 0.2s;
}

.th-mega-tab:hover, .th-mega-tab.active {
    background-color: #fff;
    color: var(--color-gold);
    border-right: 3px solid var(--color-gold);
    padding-right: 17px; /* تعويض البوردر */
}

.th-mega-pane {
    display: none;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- إصلاحات عامة --- */
.text-gold { color: var(--color-gold) !important; }
.hover\:text-gold:hover { color: var(--color-gold) !important; }


</style>
<script>
// Tharaa Header/Menu enhancements (Tabs + Mobile Accordion)
// Paste into your main JS bundle (e.g. src/assets/js/app.js)



    // Tharaa Header/Menu enhancements (Tabs + Mobile Accordion)
// Paste into your main JS bundle (e.g. src/assets/js/app.js)

(function () {
  function ready(fn){ if(document.readyState !== 'loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }

  ready(function () {
    const menu = document.querySelector('#mobile-menu[data-th-menu]');
    if (!menu) return;

    // 1) Mobile accordion
    menu.addEventListener('click', function (e) {
      const btn = e.target.closest('[data-th-acc-toggle]');
      if (!btn) return;

      const panel = btn.closest('.th-hdr__m-item')?.querySelector('[data-th-acc-panel]');
      if (!panel) return;

      const isOpen = !panel.hidden;
      panel.hidden = isOpen;
      btn.setAttribute('aria-expanded', isOpen ? 'false' : 'true');

      const plus = btn.querySelector('.th-hdr__m-plus');
      if (plus) plus.textContent = isOpen ? '+' : '−';
    });

    // 2) Mega tabs (desktop)
    const megaRoot = menu.querySelector('[data-th-mega]');
    if (!megaRoot) return;

    const btns = megaRoot.querySelectorAll('[data-th-tab-btn]');
    const panes = megaRoot.querySelectorAll('[data-th-tab-pane]');

    function activate(btn){
      const id = btn.getAttribute('data-th-tab-target');
      if (!id) return;

      btns.forEach(b => b.classList.remove('is-active'));
      panes.forEach(p => p.classList.remove('is-active'));

      btn.classList.add('is-active');
      const pane = megaRoot.querySelector('#' + CSS.escape(id));
      if (pane) pane.classList.add('is-active');
    }

    btns.forEach(btn => {
      btn.addEventListener('mouseenter', () => activate(btn));
      btn.addEventListener('focus', () => activate(btn));
      btn.addEventListener('click', () => activate(btn));
    });

    // 3) Mega open/close (click + hover)
    const toggle = megaRoot.querySelector('[data-th-mega-toggle]');
    const panel = megaRoot.querySelector('[data-th-mega-panel]');
    if (!toggle || !panel) return;

    function setOpen(open){
      panel.hidden = !open;
      toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      megaRoot.classList.toggle('is-open', open);
    }

    // Hover open (desktop feel)
    megaRoot.addEventListener('mouseenter', () => setOpen(true));
    megaRoot.addEventListener('mouseleave', () => setOpen(false));

    toggle.addEventListener('click', function (e) {
      e.preventDefault();
      setOpen(panel.hidden);
    });

    document.addEventListener('click', function (e) {
      if (!megaRoot.contains(e.target)) setOpen(false);
    });

    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') setOpen(false);
    });
  });
})();



</script>

