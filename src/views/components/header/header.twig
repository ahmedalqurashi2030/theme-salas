{#
| Variable         | Type    | Description                     |
|------------------|---------|---------------------------------|
| cart             | object  |                                 |
| cart.items_count | int     |                                 |
| cart.total       | string  | Formatted total ex: "١٠٠ ر.س"   |
#}

<header
	class="store-header th-hdr">
	{# Top Utility Bar (Optional Shipping/Ads) #}
	{% if advertisement is defined and advertisement %}
		{% include 'components.header.advertisement' ignore missing with {advertisement: advertisement} %}
	{% endif %}

	{# Row 1: Top Header (Logo - Search - Icons) #}
	<div class="th-hdr__top">
		<div
			class="container th-hdr__top-inner">
			{# Right: Logo #}
			<div class="th-hdr__logo">
				<a class="navbar-brand" href="{{ store.url }}">
					<img fetchpriority="high" loading="eager" src="{{ store.logo }}" alt="{{ store.name }}">
				</a>
			</div>

			{# Center: Search #}
			<div class="th-hdr__search">
				<salla-search inline oval height="42" placeholder="{{ trans('blocks.header.search_placeholder') }}"></salla-search>
			</div>

			{# Left: Icons (Cart - Heart - User) #}
			<div
				class="th-hdr__icons">
				{# Cart #}
				<salla-cart-summary class="th-hdr__icon-btn">
					<i slot="icon" class="sicon-shopping-bag"></i>
				</salla-cart-summary>

				{# Wishlist (Heart) #}
				<a href="{{ link('wishlist') }}" class="th-hdr__icon-btn">
					<i class="sicon-heart"></i>
					<span class="th-hdr__icon-label">{{ trans('blocks.header.wishlist') }}</span>
				</a>

				{# User / Account #}
				{% if user.type=='user' %}
					<salla-user-menu avatar-only show-header></salla-user-menu>
				{% else %}
					<button class="th-hdr__icon-btn" onclick="salla.event.dispatch('login::open')">
						<i class="sicon-user"></i>
						<span class="th-hdr__icon-label">{{ trans('blocks.header.my_account') }}</span>
					</button>
				{% endif %}
			</div>
		</div>
	</div>

	{# Row 2: Navigation Bar #}
	<div class="th-hdr__bottom">
		<div
			class="container th-hdr__bottom-inner">
			{# Mobile Burger (Visible only on mobile) #}
			<a class="lg:hidden mburger mburger--collapse leading-none rtl:ml-4 ltr:mr-4" href="#mobile-menu">
				<i class="sicon-menu text-2xl"></i>
			</a>

			{# Right: All Categories (Trigger for Mega Menu if needed) #}
			<div class="th-hdr__all-cats hidden lg:flex">
				<button class="th-hdr__all-cats-btn">
					<i class="sicon-menu rtl:ml-2 ltr:mr-2"></i>
					<span>{{ trans('blocks.header.all_categories') }}</span>
					{# Or static text 'جميع الأقسام' if trans not available #}
				</button>
			</div>

			{# Center/Left: Main Menu #}
			<div class="th-hdr__nav hidden lg:block">
				{% component 'header.menu' %}
			</div>

			{# Mobile Search (Visible only on mobile) #}
			<div class="lg:hidden flex-1 th-hdr__search-mobile">
				<salla-search inline oval height="36"></salla-search>
			</div>
		</div>
	</div>
</header>

{% if store.scope %}
	<salla-scopes selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"></salla-scopes>
{% endif %}


<script>

	export function initThPremiumHeader() {
document.querySelectorAll('[data-th-mega]').forEach((root) => {
const panel = root.querySelector('[data-th-mega-panel]');
const toggle = root.querySelector('[data-th-mega-toggle]');
const tabs = root.querySelectorAll('[data-th-mega-tab]');
const panes = root.querySelectorAll('[data-th-mega-pane]');

const setOpen = (open) => {
if (! panel) 
return;


panel.hidden = !open;
toggle ?. setAttribute('aria-expanded', open ? 'true' : 'false');
};

toggle ?. addEventListener('click', (e) => {
e.preventDefault();
setOpen(panel ?. hidden ?? true);
});

const activate = (idx) => {
tabs.forEach(t => t.classList.remove('is-active'));
panes.forEach(p => p.classList.remove('is-active'));
tabs[idx] ?. classList.add('is-active');
panes[idx] ?. classList.add('is-active');
};

tabs.forEach((t) => {
const idx = Number(t.getAttribute('data-th-mega-tab'));
t.addEventListener('mouseenter', () => activate(idx));
t.addEventListener('focus', () => activate(idx));
t.addEventListener('click', () => activate(idx));
});

// Close on outside click
document.addEventListener('click', (e) => {
if (! panel || panel.hidden) 
return;


if (root.contains(e.target)) 
return;


setOpen(false);
});

// Escape
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape') 
setOpen(false);


});
});
}
</script>
