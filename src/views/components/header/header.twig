{#
| Variable         | Type    | Description                     |
|------------------|---------|---------------------------------|
| cart             | object  |                                 |
| cart.items_count | int     |                                 |
| cart.total       | string  | Formatted total ex: "١٠٠ ر.س"   |
#}
<header
	id="custom-tharaa-header">
	{# Hook: Salla requirement #}
	{{ content_for_header }}

	{# 1. TOP BAR #}
	<div class="cth-top-bar">
		<div
			class="container">
			{# Left Side: Footer/Help Menu (Dynamic) #}
			<div class="cth-top-menu">
				{% component 'footer.menu' with {is_header:true} %}
			</div>

			{# Right Side: Currency, Language, Location #}
			<div class="cth-top-links">
				{% if store.settings.is_multilingual or store.settings.currencies_enabled %}
					<button type="button" onclick="salla.event.dispatch('localization::open')">
						<span class="flag iti__flag iti__{{ user.language.country_code }} rounded-sm"></span>
						<span class="mx-1.5">|</span>
						<span>{{ currency.symbol }}</span>
					</button>
					<salla-localization-modal></salla-localization-modal>
				{% endif %}

				{% if store.scope %}
					<button onclick="salla.event.dispatch('scopes::open', {'mode': 'default'})">
						<i class="sicon-location"></i>
						{{ store.scope.name }}
					</button>
				{% endif %}
			</div>
		</div>
	</div>

	{# 2. MAIN HEADER #}
	<div class="cth-main-header">
		<div class="container">
			<div
				class="cth-main-row">
				{# Mobile Burger Trigger #}
				<a href="#mobile-menu" class="cth-burger-btn lg:hidden">
					<i class="sicon-menu"></i>
				</a>

				{# Logo #}
				<div class="cth-logo">
					<a href="{{ store.url }}">
						<img src="{{ store.logo }}" alt="{{ store.name }}" loading="eager">
					</a>
				</div>

				{# Search #}
				<div class="cth-search-wrapper hidden lg:block">
					<salla-search inline oval height="42"></salla-search>
				</div>

				{# Actions #}
				<div
					class="cth-actions">
					{# User #}
					{% if user.type == 'user' %}
						<salla-user-menu avatar-only show-header></salla-user-menu>
					{% else %}
						<button class="cth-action-item" onclick="salla.event.dispatch('login::open')">
							<i class="sicon-user-circle"></i>
							<span class="hidden lg:block">{{ trans('blocks.header.login') }}</span>
						</button>
					{% endif %}

					{# Cart #}
					<salla-cart-summary class="cth-action-item">
						<i slot="icon" class="sicon-shopping-bag"></i>
					</salla-cart-summary>
				</div>
			</div>

			{# Mobile Search #}
			<div class="lg:hidden mt-4 pb-2">
				<salla-search inline oval height="38"></salla-search>
			</div>
		</div>
	</div>

	{# 3. NAV BAR #}
	<div class="cth-nav-bar hidden lg:block">
		<div
			class="container cth-nav-container">
			{# Sidebar Trigger & Dropdown #}
			<div class="cth-cat-wrapper relative group">
				<div id="cth-trigger" class="cth-cat-trigger">
					<button type="button">
						<i class="sicon-menu menu-icon"></i>
						<span>{{ trans('blocks.header.categories')|default('كل الأصناف') }}</span>
						<i class="sicon-keyboard_arrow_down arrow-icon"></i>
					</button>
				</div>

				{# Dynamic Sidebar Menu #}
				<div id="cth-dropdown" class="cth-sidebar-dropdown">
					<ul class="cth-vertical-menu">
						{# Iterate Main Menu Items #}
						{# Note: 'menus.main_menu' is usually 'menus.main_menu.items' or just 'menus.main_menu' #}
						{# In Tharaa usually: component 'header.menu' handles this. But we need custom markup. #}
						{# Variables: site.menus.main_menu #}

							{% for item in menus.main_menu %}
								<li>
									<a
									href="{{ item.url }}"> <!-- Icon Logic -->
									{% if item.icon %}
										<i class="{{ item.icon }}" style="width:24px;text-align:center;"></i>
									{% elseif item.image %}
										<img src="{{ item.image }}" alt="{{ item.title }}" style="width:20px;height:20px;">
									{% else %}
										<i class="sicon-layout" style="width:24px;text-align:center;"></i>
									{% endif %}

									<span>{{ item.title }}</span>

									{% if item.children|length > 0 %}
										<i class="sicon-keyboard_arrow_left ltr:rotate-180 opacity-50 text-xs" style="margin-right:auto;"></i>
									{% endif %}
								</a>

								{# Mega Menu (Level 2) #}
								{% if item.children|length > 0 %}
									<div class="cth-mega-menu">
										{% for sub in item.children %}
											<div class="mega-column">
												<a href="{{ sub.url }}" class="mega-title">{{ sub.title }}</a>
												{% if sub.children|length > 0 %}
													<ul>
														{% for child in sub.children %}
															<li>
																<a href="{{ child.url }}">{{ child.title }}</a>
															</li>
														{% endfor %}
													</ul>
												{% endif %}
											</div>
										{% endfor %}
									</div>
								{% endif %}
							</li>
						{% endfor %}
					</ul>
				</div>
			</div>

			{# Horizontal Menu #}
			<div class="cth-horiz-menu flex-1 margin-start-4">
				<ul class="flex gap-6 items-center">{# Use header_menu if available or hardcode important links #}
					{# Usually we iterate the same menu but exclude first item, or use a separate menu #}
				</ul>
			</div>
		</div>
	</div>

	{# Backdrop #}
	<div id="cth-backdrop" class="cth-backdrop"></div>

	{% hook 'header:end' %}
</header>
{% if store.scope %}
	<salla-scopes selection="{{ store.scope.display_as == 'popup' ? 'mandatory' : 'optional' }}"></salla-scopes>
{% endif %}

{# Scoped JavaScript #}
<script>
	document.addEventListener('DOMContentLoaded', () => {
const header = document.getElementById('custom-tharaa-header');
if (! header) 
return;


const trigger = header.querySelector('#cth-trigger button'); // target the button inside
const triggerWrapper = header.querySelector('#cth-trigger');
const backdrop = document.getElementById('cth-backdrop');

if (trigger && backdrop) { // Toggle Sidebar
trigger.addEventListener('click', (e) => {
e.stopPropagation();
triggerWrapper.classList.toggle('is-active');
backdrop.classList.toggle('is-visible');
});

// Close on Backdrop Click
backdrop.addEventListener('click', () => {
triggerWrapper.classList.remove('is-active');
backdrop.classList.remove('is-visible');
});

// Close on Click Outside
document.addEventListener('click', (e) => {
if (! triggerWrapper.contains(e.target) && !document.getElementById('cth-dropdown').contains(e.target)) {
triggerWrapper.classList.remove('is-active');
backdrop.classList.remove('is-visible');
}
});
}
});
</script>
