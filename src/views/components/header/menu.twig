{#
| Variable             | Type                   | Description                                        |
|----------------------|------------------------|----------------------------------------------------|
| menus                | Menu[] *Collection     | List of menus                                      |
| menus[].has_children | Bool                   |                                                    |
| menus[].url          | string                 |                                                    |
| menus[].title        | string                 |                                                    |
| menus[].attrs        | string                 | Menu dom attributes ex: ` id="offers"`             |
| menus[].link_attrs   | string                 | Menu link dom attributes ex: `class="offers-link"` |
| menus[].children     | Menu[] *Collection     |                                                    |
| menus[].products     | ?Product[] *Collection | List of selected products or null                  |
#}

{% set mega_tabs = [] %}
{% for menu_id, m in menus %}
  {% if m.has_children %}
    {% set mega_tabs = mega_tabs|merge([m]) %}
  {% endif %}
{% endfor %}
{% set mega_tabs = mega_tabs|slice(0, 10) %}

<nav id="mobile-menu" class="mobile-menu th-hdr__drawer">
    <ul class="main-menu th-hdr__menu">

        {# زر جميع الأقسام (Desktop فقط) #}
        {% if mega_tabs|length %}
            <li class="!hidden lg:!inline-flex root-level th-hdr__allcats" data-th-mega>
                <button type="button" class="th-hdr__allcats-btn" data-th-mega-toggle aria-expanded="false">
                    <i class="sicon-menu th-hdr__allcats-ico rtl:ml-2 ltr:mr-2"></i>
                    <span>جميع الأقسام</span>
                </button>

                <div class="th-hdr__mega" data-th-mega-panel hidden>
                    <div class="th-hdr__mega-side">
                        {% for t in mega_tabs %}
                            <button type="button"
                                    class="th-hdr__mega-tab {{ loop.first ? 'is-active' : '' }}"
                                    data-th-mega-tab="{{ loop.index0 }}">
                                <span>{{ t.title }}</span>
                                <i class="sicon-keyboard_arrow_left"></i>
                            </button>
                        {% endfor %}
                    </div>

                    <div class="th-hdr__mega-content">
                        {% for t in mega_tabs %}
                            <div class="th-hdr__mega-pane {{ loop.first ? 'is-active' : '' }}"
                                 data-th-mega-pane="{{ loop.index0 }}">

                                <div class="th-hdr__mega-grid">
                                    {% for group in t.children %}
                                        <div class="th-hdr__mega-group">
                                            <a href="{{ group.url }}" class="th-hdr__mega-title">{{ group.title }}</a>

                                            {% if group.children is defined and group.children and (group.children|length) %}
                                                {% for link in group.children|slice(0, 12) %}
                                                    <a href="{{ link.url }}" class="th-hdr__mega-link">{{ link.title }}</a>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>

                                {% if t.products %}
                                    <div class="th-hdr__mega-products">
                                        <div class="grid gap-4 grid-cols-4">
                                            {% for product in t.products|slice(0, 4) %}
                                                <salla-product-card shadow-on-hover product="{{ product }}"></salla-product-card>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endif %}

                            </div>
                        {% endfor %}
                    </div>
                </div>
            </li>
        {% endif %}

        {# بقية القوائم الأصلية #}
        {% for menu_id, menu in menus %}
            {% include 'components.header._menu-item' with {is_root_menu:true} %}
        {% endfor %}
    </ul>

    <button class="btn--close close-mobile-menu sicon-cancel lg:hidden"></button>
</nav>

<button class="btn--close-sm close-mobile-menu sicon-cancel lg:hidden"></button>
