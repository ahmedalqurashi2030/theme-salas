{#
| Variable             | Type                   | Description                                        |
|----------------------|------------------------|----------------------------------------------------| 
| menus                | Menu[] *Collection     | List of menus                                      |
| menus[].has_children | Bool                   |                                                    |
| menus[].url          | string                 |                                                    |
| menus[].title        | string                 |                                                    |
| menus[].attrs        | string                 | Menu dom attributes ex: ` id="offers"`             |
| menus[].link_attrs   | string                 | Menu link dom attributes ex: `class="offers-link"` |
| menus[].children     | Menu[] *Collection     |                                                    |
| menus[].products     | ?Product[] *Collection | List of selected products or null                  |
#}

{# DESKTOP MENU #}
<div class="flex items-center h-full gap-8">
	{# 1. زر جميع الأقسام (Mega Menu) #}
	<div class="th-all-cats-wrapper group">
		<div class="th-all-cats-btn">
			<i class="sicon-layout-grid text-lg"></i>
			<span>{{ trans('blocks.header.all_categories') }}</span>
			<i class="sicon-keyboard_arrow_down text-xs opacity-50 mt-1 mr-auto"></i>
		</div>

		<div class="th-mega-menu">
			{# القائمة الجانبية #}
			<div class="th-mega-sidebar">
				{% for menu in menus %}
                    <!-- DEBUG: Processing menu {{ menu.title }} -->
					{% if menu.has_children %}
						<div class="th-mega-tab {{ loop.first ? 'active' : '' }}" onmouseover="tharaaOpenTab(event, 'mega-{{ loop.index }}')">
							{{ menu.title }}
							{% if menu.image %}
								<img src="{{ menu.image }}" alt="{{ menu.title }}" class="w-8 h-8 rounded-full object-cover bg-gray-50">
							{% else %}
								<span class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400 text-xs">
									<i class="sicon-layout-grid"></i>
								</span>
							{% endif %}
						</div>
					{% endif %}
				{% endfor %}
			</div>
			
			{# المحتوى #}
			<div class="th-mega-content overflow-y-auto">
				{% for menu in menus %}
					{% if menu.has_children %}
						<div id="mega-{{ loop.index }}" class="th-mega-pane {{ loop.first ? 'active' : '' }}">
							<div class="grid grid-cols-3 gap-8">
								{% for child in menu.children %}
									<div>
										<a href="{{ child.url }}" class="font-bold text-gray-800 mb-3 block hover:text-gold transition flex items-center gap-2">
											{% if child.image %}
												<img src="{{ child.image }}" alt="{{ child.title }}" class="w-8 h-8 rounded-full object-cover bg-gray-50">
											{% else %}
												<span class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400 text-xs">
													<i class="sicon-layout-grid"></i>
												</span>
											{% endif %}
											{{ child.title }}
										</a>
										{% if child.children|length > 0 %}
											<ul class="space-y-2 pr-10 border-r border-gray-50">
												{% for sub in child.children %}
													<li>
														<a href="{{ sub.url }}" class="text-sm text-gray-500 hover:text-gold transition block hover:translate-x-[-3px]">{{ sub.title }}</a>
													</li>
												{% endfor %}
											</ul>
										{% endif %}
									</div>
								{% endfor %}
							</div>
							
							{# منتجات مقترحة #}
							{% if menu.products %}
								<div class="mt-8 pt-6 border-t border-gray-100">
									<h4 class="font-bold mb-4 text-sm text-gold">{{ trans('blocks.header.featured_products') }}</h4>
									<div class="grid grid-cols-4 gap-4">
										{% for product in menu.products|slice(0, 4) %}
											<salla-product-card shadow-on-hover product="{{ product }}" class="text-xs"></salla-product-card>
										{% endfor %}
									</div>
								</div>
							{% endif %}
						</div>
					{% endif %}
				{% endfor %}
			</div>
		</div>
	</div>

	{# 2. الروابط الرئيسية (Cascading) #}
	<ul class="th-nav-list flex items-center gap-6 h-full">
		{% for menu in menus %}
			{% include 'components.header._menu-item' with { is_root: true } %}
		{% endfor %}
	</ul>
</div>

<script>
	// Mega Menu Tab Switching
	function tharaaOpenTab(evt, id) {
		document.querySelectorAll('.th-mega-pane').forEach(el => el.classList.remove('active'));
		document.querySelectorAll('.th-mega-tab').forEach(el => el.classList.remove('active'));
		document.getElementById(id).classList.add('active');
		evt.currentTarget.classList.add('active');
	}
</script>
