{#
| Variable             | Type                   | Description                                        |
|----------------------|------------------------|----------------------------------------------------|
| menus                | Menu[] *Collection     | List of menus                                      |
| menus[].has_children | Bool                   |                                                    |
| menus[].url          | string                 |                                                    |
| menus[].title        | string                 |                                                    |
| menus[].attrs        | string                 | Menu dom attributes ex: ` id="offers"`             |
| menus[].link_attrs   | string                 | Menu link dom attributes ex: `class="offers-link"` |
| menus[].children     | Menu[] *Collection     |                                                    |
| menus[].products     | ?Product[] *Collection | List of selected products or null                  |
#}

{# نجهّز أقسام الميجا من نفس قائمة سلة (العناصر اللي لها Children) #}
{% set mega_roots = [] %}
{% for _id, m in menus %}
  {% if m.has_children %}
    {% set mega_roots = mega_roots|merge([m]) %}
  {% endif %}
{% endfor %}

<nav id="mobile-menu" class="mobile-menu th-hdr__menu" data-th-menu>

  <div class="th-hdr__navWrap">

    {# زر "جميع الأقسام" + Mega Tabs (Desktop Only) #}
    {% if mega_roots|length %}
      <div class="th-hdr__allCats hidden lg:flex" data-th-mega>
        <button type="button" class="th-hdr__allCatsBtn" data-th-mega-toggle aria-expanded="false">
          <i class="sicon-menu th-hdr__allCatsIco"></i>
          <span>جميع الأقسام</span>
        </button>

        <div class="th-hdr__mega" data-th-mega-panel hidden>
          <div class="th-hdr__megaSide">
            {% for m in mega_roots|slice(0, 10) %}
              <button type="button"
                      class="th-hdr__megaTab {{ loop.first ? 'is-active' : '' }}"
                      data-th-tab-btn data-th-tab-target="th-mega-{{ loop.index }}">
                <span>{{ m.title }}</span>
                <span aria-hidden="true">‹</span>
              </button>
            {% endfor %}
          </div>

          <div class="th-hdr__megaContent">
            {% for m in mega_roots|slice(0, 10) %}
              <div class="th-hdr__megaPane {{ loop.first ? 'is-active' : '' }}" id="th-mega-{{ loop.index }}" data-th-tab-pane>
                <div class="th-hdr__megaGrid">
                  {% for child in m.children %}
                    <div class="th-hdr__megaGroup">
                      <a class="th-hdr__megaTitle" href="{{ child.url }}">{{ child.title }}</a>

                      {% if child.has_children %}
                        {% for sub in child.children|slice(0, 12) %}
                          <a class="th-hdr__megaLink" href="{{ sub.url }}">{{ sub.title }}</a>
                        {% endfor %}
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>

                {% if m.products %}
                  <div class="th-hdr__megaProducts">
                    <div class="th-hdr__megaProductsGrid">
                      {% for product in m.products|slice(0, 4) %}
                        <salla-product-card shadow-on-hover product="{{ product }}"></salla-product-card>
                      {% endfor %}
                    </div>
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% endif %}

    <ul class="main-menu th-hdr__links">
      {% for menu_id, menu in menus %}
        {% include 'components.header._menu-item' with {is_root_menu:true} %}
      {% endfor %}
    </ul>

  </div>

  <button class="btn--close close-mobile-menu sicon-cancel lg:hidden" aria-label="إغلاق القائمة"></button>
</nav>

<button class="btn--close-sm close-mobile-menu sicon-cancel lg:hidden" aria-label="إغلاق القائمة"></button>
