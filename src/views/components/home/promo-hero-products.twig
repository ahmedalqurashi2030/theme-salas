{#
  Promo Hero Products
  Path: home.promo-hero-products
#}

{% set title = component.title ?? 'Apple Shopping Event' %}
{% set description = component.description ?? '' %}
{% set hero_image = component.hero_image ?? null %}
{% set countdown_end = component.countdown_end ?? '' %}
{% set show_countdown_raw = component.show_countdown ?? false %}
{% set show_countdown = show_countdown_raw in [true, 1, '1', 'true'] %}
{% set show_rating_raw = component.show_price ?? false %}
{% set show_rating = show_rating_raw in [true, 1, '1', 'true'] %}
{% set button_text = component.button_text ?? 'Go Shopping' %}
{% set button_link = component.button_link ?? '' %}
{% set products = component.products ?? [] %}
{% set should_scroll_products = products|length > 4 %}
{% set section_id = 'th-promo-hero-' ~ position %}
{% set hero_image_src = hero_image ?? 'images/placeholder.png'|asset %}

<section class="s-block th-promo-hero {{ should_scroll_products ? 'th-promo-hero--scroll-products' : 'th-promo-hero--grid-products' }}" id="{{ section_id }}" aria-labelledby="{{ section_id }}-title">
  <div class="container">
    <div class="th-promo-hero__shell grid gap-6 overflow-hidden rounded-[20px] border border-[#e4e8f1] p-6 shadow-[0_16px_30px_rgba(17,24,39,0.08)] md:p-8">
      <header class="th-promo-hero__header grid gap-4 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1.3fr)] lg:items-center lg:gap-8">
        <figure class="th-promo-hero__visual order-1 m-0 grid place-items-center">
          <img src="{{ hero_image_src }}"
               alt="{{ title }}"
               class="th-promo-hero__hero-image"
               loading="lazy"
               decoding="async">
        </figure>

        <div class="th-promo-hero__content order-2 grid content-center gap-3 text-start">
          <span class="th-promo-hero__eyebrow inline-flex min-h-[28px] w-fit items-center rounded-full px-2.5">Limited Offer</span>
          <h2 class="th-promo-hero__title" id="{{ section_id }}-title">{{ title }}</h2>

          {% if description %}
            <div class="th-promo-hero__description">{{ description|raw }}</div>
          {% endif %}

          {% if show_countdown and countdown_end %}
            <div class="th-promo-hero__timer-wrap grid gap-2">
              <p class="th-promo-hero__timer-label m-0">Offer ends in</p>
              <div class="th-promo-hero__timer grid grid-cols-4 gap-2"
                   data-th-promo-countdown
                   data-end="{{ countdown_end|e('html_attr') }}"
                   data-expired-text="Offer has ended"
                   role="timer"
                   aria-live="polite"
                   aria-atomic="true">
                <div class="th-promo-hero__timer-item grid min-h-[74px] content-center place-items-center text-center rounded-[10px]">
                  <span class="th-promo-hero__timer-value" data-part="days">00</span>
                  <span class="th-promo-hero__timer-unit">Days</span>
                </div>
                <div class="th-promo-hero__timer-item grid min-h-[74px] content-center place-items-center text-center rounded-[10px]">
                  <span class="th-promo-hero__timer-value" data-part="hours">00</span>
                  <span class="th-promo-hero__timer-unit">Hr</span>
                </div>
                <div class="th-promo-hero__timer-item grid min-h-[74px] content-center place-items-center text-center rounded-[10px]">
                  <span class="th-promo-hero__timer-value" data-part="minutes">00</span>
                  <span class="th-promo-hero__timer-unit">Min</span>
                </div>
                <div class="th-promo-hero__timer-item grid min-h-[74px] content-center place-items-center text-center rounded-[10px]">
                  <span class="th-promo-hero__timer-value" data-part="seconds">00</span>
                  <span class="th-promo-hero__timer-unit">Sec</span>
                </div>
              </div>
              <p class="th-promo-hero__timer-expired" data-th-promo-expired hidden>Offer has ended</p>
            </div>
          {% endif %}

          {% if button_text and button_link %}
            <a href="{{ button_link }}" class="th-promo-hero__cta inline-flex min-h-11 w-fit items-center gap-2 rounded-[10px] px-4 py-2.5" aria-label="{{ button_text }}">
              <span>{{ button_text }}</span>
              <i class="sicon-keyboard_arrow_left" aria-hidden="true"></i>
            </a>
          {% endif %}
        </div>
      </header>

      <div class="th-promo-hero__products grid gap-4" aria-label="Featured products">
        <p class="th-promo-hero__products-heading m-0 text-start text-sm font-bold">Featured Products</p>

        {% if products|length %}
          <div class="th-promo-hero__products-list flex gap-4 overflow-x-auto pb-2 snap-x snap-mandatory {{ should_scroll_products ? '' : 'lg:grid lg:grid-cols-4 lg:overflow-visible lg:snap-none lg:pb-0' }}" data-th-promo-products-track>
            {% for product in products %}
              {% set product_id = product.id ?? null %}
              {% set product_url = product.url ?? '#' %}
              {% set product_name = product.name ?? 'Product' %}
              {% set product_image = product.image.url ?? product.image ?? 'images/placeholder.png'|asset %}
              {% set product_image_alt = product.image.alt ?? product_name %}
              {% set product_price = product.sale_price ?? product.price ?? product.regular_price ?? null %}
              {% set product_stars = product.rating.stars ?? product.rating ?? 0 %}
              {% set product_stars = product_stars|round(0, 'floor') %}

              <article class="th-promo-hero__product-card flex min-w-[228px] items-center gap-2.5 overflow-hidden p-2 {{ should_scroll_products ? 'th-promo-hero__product-card--scroll snap-start' : 'lg:min-w-0' }}">
                <a href="{{ product_url }}" class="th-promo-hero__product-link flex min-w-0 flex-1 items-center gap-2.5 p-0 no-underline lg:min-h-[104px]" aria-label="{{ product_name }}">
                  <span class="th-promo-hero__product-image-wrap grid h-[58px] w-[58px] shrink-0 place-items-center overflow-hidden rounded-[10px] border border-[#e8edf7] bg-[#f8fafc]">
                    <img src="{{ product_image }}"
                         alt="{{ product_image_alt }}"
                         class="th-promo-hero__product-image"
                         loading="lazy"
                         decoding="async">
                  </span>

                  <span class="th-promo-hero__product-content grid min-w-0 gap-0.5">
                    <span class="th-promo-hero__product-title">{{ product_name }}</span>
                    {% if show_rating %}
                      <span class="th-promo-hero__rating inline-flex items-center gap-0.5" aria-label="Rating {{ product_stars }} out of 5">
                        {% for i in 1..5 %}
                          <i class="sicon-star2 {{ i <= product_stars ? 'is-active' : '' }}" aria-hidden="true"></i>
                        {% endfor %}
                      </span>
                    {% endif %}
                    {% if product_price is not null %}
                      <strong class="th-promo-hero__product-price">{{ product_price|money }}</strong>
                    {% endif %}
                  </span>
                </a>

                {% if product_id %}
                  <salla-add-product-button
                    class="th-promo-hero__add-btn"
                    product-id="{{ product_id }}"
                    product-status="{{ product.status ?? '' }}"
                    product-type="{{ product.type ?? '' }}"
                    aria-label="{{ trans('common.add_to_cart') ~ ' ' ~ product_name }}">
                    <span class="sr-only">{{ trans('common.add_to_cart') }}</span>
                    <i class="sicon-shopping-bag" aria-hidden="true"></i>
                  </salla-add-product-button>
                {% endif %}
              </article>
            {% endfor %}
          </div>

          {% if should_scroll_products %}
            <div class="th-promo-hero__scroll-track mx-auto h-1 w-[100px] overflow-hidden rounded-full" data-th-promo-scroll-track aria-hidden="true">
              <span class="th-promo-hero__scroll-thumb block h-full w-[36%] rounded-full" data-th-promo-scroll-thumb></span>
            </div>
          {% endif %}
        {% else %}
          <div class="th-promo-hero__empty rounded-[14px] border border-dashed border-[#d8dfec] bg-white/80 p-6 text-center text-sm">No selected products for this section yet.</div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
