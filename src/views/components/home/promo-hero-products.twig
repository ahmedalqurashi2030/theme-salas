{#
  Promo Hero Products
  Path: home.promo-hero-products
#}

{% set title = component.title ?? 'Apple Shopping Event' %}
{% set description = component.description ?? '' %}
{% set hero_image = component.hero_image ?? null %}
{% set countdown_end = component.countdown_end ?? '' %}
{% set show_countdown_raw = component.show_countdown ?? false %}
{% set show_countdown = show_countdown_raw in [true, 1, '1', 'true'] %}
{% set show_rating_raw = component.show_price ?? false %}
{% set show_rating = show_rating_raw in [true, 1, '1', 'true'] %}
{% set button_text = component.button_text ?? 'Go Shopping' %}
{% set button_link = component.button_link ?? '' %}
{% set products = component.products ?? [] %}
{% set section_id = 'th-promo-hero-' ~ position %}
{% set hero_image_src = hero_image ?? 'images/placeholder.png'|asset %}

<section class="s-block th-promo-hero" id="{{ section_id }}" aria-labelledby="{{ section_id }}-title">
  <div class="container">
    <div class="th-promo-hero__shell">
      <header class="th-promo-hero__header">
        <figure class="th-promo-hero__visual">
          <img src="{{ hero_image_src }}"
               alt="{{ title }}"
               class="th-promo-hero__hero-image"
               loading="lazy"
               decoding="async">
        </figure>

        <div class="th-promo-hero__content">
          <span class="th-promo-hero__eyebrow">Limited Offer</span>
          <h2 class="th-promo-hero__title" id="{{ section_id }}-title">{{ title }}</h2>

          {% if description %}
            <div class="th-promo-hero__description">{{ description|raw }}</div>
          {% endif %}

          {% if show_countdown and countdown_end %}
            <div class="th-promo-hero__timer-wrap">
              <p class="th-promo-hero__timer-label">Offer ends in</p>
              <div class="th-promo-hero__timer"
                   data-th-promo-countdown
                   data-end="{{ countdown_end|e('html_attr') }}"
                   data-expired-text="Offer has ended"
                   role="timer"
                   aria-live="polite"
                   aria-atomic="true">
                <div class="th-promo-hero__timer-item">
                  <span class="th-promo-hero__timer-value" data-part="days">00</span>
                  <span class="th-promo-hero__timer-unit">Days</span>
                </div>
                <div class="th-promo-hero__timer-item">
                  <span class="th-promo-hero__timer-value" data-part="hours">00</span>
                  <span class="th-promo-hero__timer-unit">Hr</span>
                </div>
                <div class="th-promo-hero__timer-item">
                  <span class="th-promo-hero__timer-value" data-part="minutes">00</span>
                  <span class="th-promo-hero__timer-unit">Min</span>
                </div>
                <div class="th-promo-hero__timer-item">
                  <span class="th-promo-hero__timer-value" data-part="seconds">00</span>
                  <span class="th-promo-hero__timer-unit">Sec</span>
                </div>
              </div>
              <p class="th-promo-hero__timer-expired" data-th-promo-expired hidden>Offer has ended</p>
            </div>
          {% endif %}

          {% if button_text and button_link %}
            <a href="{{ button_link }}" class="th-promo-hero__cta" aria-label="{{ button_text }}">
              <span>{{ button_text }}</span>
              <i class="sicon-keyboard_arrow_left" aria-hidden="true"></i>
            </a>
          {% endif %}
        </div>
      </header>

      <div class="th-promo-hero__products" aria-label="Featured products">
        <p class="th-promo-hero__products-heading">Featured Products</p>

        {% if products|length %}
          <div class="th-promo-hero__products-list" data-th-promo-products-track>
            {% for product in products %}
              {% set product_id = product.id ?? null %}
              {% set product_url = product.url ?? '#' %}
              {% set product_name = product.name ?? 'Product' %}
              {% set product_image = product.image.url ?? product.image ?? 'images/placeholder.png'|asset %}
              {% set product_image_alt = product.image.alt ?? product_name %}
              {% set product_price = product.sale_price ?? product.price ?? product.regular_price ?? null %}
              {% set product_stars = product.rating.stars ?? product.rating ?? 0 %}
              {% set product_stars = product_stars|round(0, 'floor') %}

              <article class="th-promo-hero__product-card">
                <a href="{{ product_url }}" class="th-promo-hero__product-link" aria-label="{{ product_name }}">
                  <span class="th-promo-hero__product-image-wrap">
                    <img src="{{ product_image }}"
                         alt="{{ product_image_alt }}"
                         class="th-promo-hero__product-image"
                         loading="lazy"
                         decoding="async">
                  </span>

                  <span class="th-promo-hero__product-content">
                    <span class="th-promo-hero__product-title">{{ product_name }}</span>
                    {% if show_rating %}
                      <span class="th-promo-hero__rating" aria-label="Rating {{ product_stars }} out of 5">
                        {% for i in 1..5 %}
                          <i class="sicon-star2 {{ i <= product_stars ? 'is-active' : '' }}" aria-hidden="true"></i>
                        {% endfor %}
                      </span>
                    {% endif %}
                    {% if product_price is not null %}
                      <strong class="th-promo-hero__product-price">{{ product_price|money }}</strong>
                    {% endif %}
                  </span>
                </a>

                {% if product_id %}
                  <salla-add-product-button
                    class="th-promo-hero__add-btn"
                    product-id="{{ product_id }}"
                    product-status="{{ product.status ?? '' }}"
                    product-type="{{ product.type ?? '' }}"
                    aria-label="{{ trans('common.add_to_cart') ~ ' ' ~ product_name }}">
                    <span class="sr-only">{{ trans('common.add_to_cart') }}</span>
                    <i class="sicon-shopping-bag" aria-hidden="true"></i>
                  </salla-add-product-button>
                {% endif %}
              </article>
            {% endfor %}
          </div>

          <div class="th-promo-hero__scroll-track" data-th-promo-scroll-track aria-hidden="true">
            <span class="th-promo-hero__scroll-thumb" data-th-promo-scroll-thumb></span>
          </div>
        {% else %}
          <div class="th-promo-hero__empty">No selected products for this section yet.</div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
