{#
|--------------------------------------------------------------------------
| Component: Brand Carousel (Tharaa)
| Path: views/components/home/th-brand-carousel.twig
|--------------------------------------------------------------------------
#}

{% set brands = component.brands %}
{% set title = component.section_title %}
{% set is_large = component.larger_size %}
{% set has_two_rows = component.two_rows %}

{% if brands|length > 0 %}
<section class="s-brand-carousel {{ is_large ? 'is-large' : '' }} {{ has_two_rows ? 'has-two-rows' : '' }}"
         id="brand-carousel-{{ component.key }}">
    
    <div class="container">
        {% if title %}
            <div class="s-brand-carousel__header">
                <h2 class="s-brand-carousel__title">{{ title }}</h2>
            </div>
        {% endif %}

        <div class="s-brand-carousel__wrapper">
            
            {# الصف الأول #}
            <div class="s-brand-carousel__row dir-normal">
                <div class="s-brand-carousel__track">
                    {# تكرار 4 مرات لضمان الامتلاء والحركة السلسة #}
                    {% for i in 1..4 %}
                        {{ _self.render_brand_items(brands, (i > 1)) }}
                    {% endfor %}
                </div>
            </div>

            {# الصف الثاني #}
            {% if has_two_rows %}
            <div class="s-brand-carousel__row dir-reverse">
                <div class="s-brand-carousel__track">
                    {% for i in 1..4 %}
                        {{ _self.render_brand_items(brands, (i > 1)) }}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

        </div>
    </div>
</section>
{% endif %}

{# 
   Macro: Render Items
   Added: tabindex="0" to allow focus/click detection on non-links
#}
{% macro render_brand_items(brands, is_hidden) %}
    {% for brand in brands %}
        {# 
           نضيف tabindex="0" لجعل العنصر قابلاً للتركيز عند الضغط عليه 
           حتى لو لم يكن رابطاً، مما يسمح بإيقاف الحركة
        #}
        <div class="s-brand-carousel__item" 
             {{ is_hidden ? 'aria-hidden="true"' : 'tabindex="0"' }}>
            
            {% if brand.url %}
                <a href="{{ brand.url }}" 
                   class="s-brand-carousel__link" 
                   aria-label="{{ brand.title|default('Brand') }}"
                   {{ is_hidden ? 'tabindex="-1"' : '' }}>
            {% endif %}
            
            <img src="{{ brand.image|cdn }}" 
                 alt="{{ brand.title|default('Brand Logo') }}" 
                 loading="lazy"
                 width="120"
                 height="80"
                 class="s-brand-carousel__img">

            {% if brand.url %}
                </a>
            {% endif %}
        </div>
    {% endfor %}
{% endmacro %}