{% set section_title = component.section_title|default('تسوق حسب الفئة') %}
{% set section_description = component.section_description|default(component.section_subtitle)|default('') %}
{% set section_more_url = component.more_url|default(component.url)|default('') %}
{% set header_alignment = component.alignment|default('start') %}
{% set section_more_label = component.more_label|default(trans('common.view_all')) %}
{% set show_more = component.show_more|default(section_more_url is not empty) %}

{% set display_mode_raw = component.display_mode.selected[0].label|default(component.display_mode.selected[0].value|default(component.display_mode.value|default('slider')))|lower %}
{% set display_mode = (display_mode_raw in ['list','قائمة']) ? 'list' : 'slider' %}
{% set autoplay = component.autoplay|default(false) %}
{% set show_controls = component.show_controls|default(true) %}
{% set two_rows = component.two_rows|default(false) %}

{% set items_mobile_raw = component.items_per_view_mobile.selected[0].value|default(component.items_per_view_mobile.selected[0].label|default(component.items_per_view_mobile.value|default(component.items_per_view_mobile|default('3')))) %}
{% set items_mobile = (items_mobile_raw in ['1','2','3','4']) ? items_mobile_raw : '3' %}
{% set items_desktop_raw = component.items_per_view_desktop.selected[0].value|default(component.items_per_view_desktop.selected[0].label|default(component.items_per_view_desktop.value|default(component.items_per_view_desktop|default('5')))) %}
{% set items_desktop = (items_desktop_raw in ['4','5','6','7','8']) ? items_desktop_raw : '5' %}

{% set items = component.items|default([]) %}
{% set section_id = 'tharaa-square-' ~ random() %}

{% if items is not empty %}
	<section class="s-block tharaa-links-section style-square py-10 md:py-14 {{ display_mode == 'list' ? 'mode-grid' : '' }} {{ two_rows ? 'mode-double' : '' }}" id="{{ section_id }}" data-autoplay="{{ autoplay ? 'true' : 'false' }}" data-items-mobile="{{ items_mobile }}" data-items-desktop="{{ items_desktop }}" style="--th-items-mobile: {{ items_mobile }}; --th-items-desktop: {{ items_desktop }}; --th-gap: 20px;">
		<div class="container">

			{% include 'components.home._partials.section-header' with {
      section_title: section_title,
      section_subtitle: section_description,
      alignment: header_alignment,
      btn_text: show_more ? section_more_label : '',
      btn_url: section_more_url
    } %}

			<div class="tharaa-track-wrapper">
				{% if show_controls %}
					<button class="tharaa-nav-btn btn-prev" aria-label="{{ trans('common.previous') }}">
						<i class="sicon-chevron-{{ user.language.dir == 'rtl' ? 'right' : 'left' }}"></i>
					</button>
					<button class="tharaa-nav-btn btn-next" aria-label="{{ trans('common.next') }}">
						<i class="sicon-chevron-{{ user.language.dir == 'rtl' ? 'left' : 'right' }}"></i>
					</button>
				{% endif %}

				<div class="tharaa-track">
					{% for item in items %}
						<a href="{{ item.url|default('#') }}" class="tharaa-card flex flex-col items-center text-center" aria-label="{{ item.title }}">
							<div class="tharaa-card__visual">
								<img class="tharaa-card__img" src="{{ item.image }}" alt="{{ item.title }}" loading="lazy" decoding="async">
							</div>
							<div class="tharaa-card__content mt-3 text-center">
								<span class="tharaa-card__title block mb-0.5">{{ item.title }}</span>
								{% if item.count is defined %}
									<span class="tharaa-card__count">{{ item.count }}</span>
								{% endif %}
							</div>
						</a>
					{% endfor %}
				</div>
			</div>

			<div class="tharaa-progress mx-auto mt-3">
				<div class="tharaa-progress__bar"></div>
			</div>
		</div>
	</section>
{% endif %}
