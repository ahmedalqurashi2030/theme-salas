{# Home blog section (home.th-blog) #}

{% set section_title_raw = component.section_title|default('') %}
{% if section_title_raw is iterable %}
	{% set section_title = section_title_raw.value|default(section_title_raw.ar|default(section_title_raw.en|default(''))) %}
{% else %}
	{% set section_title = section_title_raw %}
{% endif %}

{% set section_subtitle_raw = component.section_subtitle|default('') %}
{% if section_subtitle_raw is iterable %}
	{% set section_subtitle = section_subtitle_raw.value|default(section_subtitle_raw.ar|default(section_subtitle_raw.en|default(''))) %}
{% else %}
	{% set section_subtitle = section_subtitle_raw %}
{% endif %}
{% if section_subtitle in ['section_title', 'section_subtitle'] %}
	{% set section_subtitle = '' %}
{% endif %}

{% set is_ar = user is defined and user.language is defined and user.language.code|default('ar') == 'ar' %}
{% if not section_subtitle %}
	{% set section_subtitle = is_ar ? 'استكشف أحدث الأخبار والمراجعات والمحتوى التقني' : 'Discover the latest news, reviews, and tech stories' %}
{% endif %}
{% set generic_category = is_ar ? 'تقنية' : 'Tech' %}

{% set show_controls_raw = component.show_controls|default(true) %}
{% if show_controls_raw is iterable %}
	{% set show_controls_raw = show_controls_raw.value|default(show_controls_raw.selected|default(show_controls_raw)) %}
{% endif %}
{% set autoplay_raw = component.autoplay|default(true) %}
{% if autoplay_raw is iterable %}
	{% set autoplay_raw = autoplay_raw.value|default(autoplay_raw.selected|default(autoplay_raw)) %}
{% endif %}
{% set show_controls = show_controls_raw in [true, 1, '1', 'true'] %}
{% set autoplay = autoplay_raw in [true, 1, '1', 'true'] %}

{# Salla can expose posts as top-level `posts` or `component.posts` #}
{% set posts_field = posts|default(component.posts|default([])) %}
{% if (posts_field is empty) and (component.posts is defined) %}
	{% set posts_field = component.posts %}
{% endif %}
{% if posts_field is iterable and posts_field.items is defined and posts_field.items is iterable and posts_field.items|length %}
	{% set raw_posts = posts_field.items %}
{% elseif posts_field is iterable and posts_field.data is defined and posts_field.data is iterable and posts_field.data|length %}
	{% set raw_posts = posts_field.data %}
{% elseif posts_field is iterable and posts_field.selected is defined and posts_field.selected is iterable and posts_field.selected|length %}
	{% set raw_posts = posts_field.selected %}
{% elseif posts_field is iterable and posts_field.value is defined and posts_field.value is iterable and posts_field.value|length %}
	{% set raw_posts = posts_field.value %}
{% elseif posts_field is iterable %}
	{% set raw_posts = posts_field %}
{% else %}
	{% set raw_posts = [] %}
{% endif %}

{% set selected_article_ids = [] %}
{% set articles = [] %}
{% for item in raw_posts %}
	{% set post = item %}
	{% if item is iterable and item.post is defined %}
		{% set post = item.post %}
	{% elseif item is iterable and item.article is defined %}
		{% set post = item.article %}
	{% elseif item is iterable and item.data is defined %}
		{% set post = item.data %}
	{% endif %}

	{% set candidate_id = '' %}
	{% if item is iterable %}
		{% if item.id is defined and item.id %}
			{% set candidate_id = item.id %}
		{% elseif item.value is defined and item.value %}
			{% if item.value is iterable %}
				{% set candidate_id = item.value.id|default(item.value.key|default(item.value.value|default(item.value.slug|default('')))) %}
			{% else %}
				{% set candidate_id = item.value %}
			{% endif %}
		{% elseif item.key is defined and item.key %}
			{% set candidate_id = item.key %}
		{% elseif item.slug is defined and item.slug %}
			{% set candidate_id = item.slug %}
		{% endif %}
	{% elseif item %}
		{% set candidate_id = item %}
	{% endif %}

	{% if candidate_id %}
		{% set selected_article_ids = selected_article_ids|merge([candidate_id]) %}
	{% endif %}

	{% if post is iterable and (post.title is defined or post.name is defined or post.summary is defined or post.excerpt is defined) %}
		{% set articles = articles|merge([post]) %}
	{% endif %}
{% endfor %}{% else %}
<div class="th-home-blog__slider js-th-blog-fallback" data-selected-ids='{{ selected_article_ids|json_encode|e("html_attr") }}' data-limit="{{ limit }}">
	<div class="th-home-blog__fallback-grid js-th-blog-grid"></div>
	<div class="th-home-blog__empty-state text-center p-8 bg-gray-50 rounded-lg border border-dashed border-gray-300 js-th-blog-empty" hidden>
		<i class="sicon-newspaper text-4xl text-gray-400 mb-4 block"></i>
		<h3 class="text-lg font-bold text-gray-700 mb-2">{{ trans('pages.blog_categories.no_articles')|default('لا توجد مقالات لعرضها') }}</h3>
		<p class="text-sm text-gray-500">
			يرجى إضافة مقالات أو تحديدها من إعدادات المكون (المدونة) في لوحة التحكم لتظهر هنا.
		</p>
	</div>
</div>{% endif %}</section>
