{% set reviews = component.items|default([]) %}
{% set slider_id = 'custom-testimonials-' ~ (position ?? 'home') %}

{% set slider_config = {
  "slidesPerView": 1,
  "spaceBetween": 14,
  "watchOverflow": true,
  "centeredSlides": false,
  "loop": reviews|length > 3,
  "breakpoints": {
    "768": {
      "slidesPerView": 2,
      "spaceBetween": 16
    },
    "1024": {
      "slidesPerView": 3,
      "spaceBetween": 18
    }
  }
} %}

<section class="s-block th-home-testimonials">
  <div class="container">
    <header class="th-home-testimonials__header">
      <h2 class="th-home-testimonials__title">تجارب عملائنا المميزة</h2>
      <p class="th-home-testimonials__subtitle">نفخر بخدمة أكثر من 10,000 عميل سعيد، تقييمكم هو دافعنا لتقديم الأفضل دائمًا.</p>

      <div class="th-home-testimonials__stats">
        <div class="th-home-testimonials__stat th-home-testimonials__stat--customers">
          <span class="th-home-testimonials__avatars" aria-hidden="true">
            {% for item in reviews|slice(0, 4) %}
              <img
                src="{{ 'images/s-empty.png' | asset }}"
                data-src="{{ item.avatar }}"
                alt=""
                class="lazy th-home-testimonials__avatar-chip">
            {% endfor %}
          </span>
          <span class="th-home-testimonials__stat-text">2k+ عميل سعيد</span>
        </div>

        <div class="th-home-testimonials__stat th-home-testimonials__stat--rating">
          <span class="th-home-testimonials__stars" aria-hidden="true">
            {% for i in 1..5 %}
              <i class="sicon-star2"></i>
            {% endfor %}
          </span>
          <strong class="th-home-testimonials__score">4.9</strong>
          <small class="th-home-testimonials__meta">بناءً على 2,450 تقييم</small>
        </div>
      </div>
    </header>

    {% if reviews|length %}
      <salla-slider
        id="{{ slider_id }}"
        class="th-home-testimonials__slider s-slider-wrapper"
        type="carousel"
        show-controls="{{ reviews|length > 1 ? 'true' : 'false' }}"
        slider-config='{{ slider_config|json_encode|e("html_attr") }}'
        {% if reviews|length > 1 %}controls-outer pagination{% endif %}>
        <div slot="items">
          {% for index, item in reviews %}
            <div class="swiper-slide th-home-testimonials__slide">
              <article class="th-home-testimonial-card">
                <div class="th-home-testimonial-card__head">
                  <span class="th-home-testimonial-card__quote" aria-hidden="true">“</span>
                  <div class="th-home-testimonial-card__stars" aria-label="rating {{ item.stars|default(5) }} out of 5">
                    {% set current_stars = item.stars|default(5) %}
                    {% for i in 1..5 %}
                      <i class="sicon-star2 {{ i <= current_stars ? 'is-filled' : '' }}"></i>
                    {% endfor %}
                  </div>
                </div>

                <p class="th-home-testimonial-card__text">{{ item.text }}</p>

                <footer class="th-home-testimonial-card__footer">
                  <span class="th-home-testimonial-card__verified">موثوق</span>

                  <div class="th-home-testimonial-card__author-wrap">
                    <div class="th-home-testimonial-card__author">
                      <strong>{{ item.name }}</strong>
                      <small>عميل موثّق</small>
                    </div>

                    <span class="th-home-testimonial-card__avatar">
                      <img
                        src="{{ 'images/s-empty.png' | asset }}"
                        data-src="{{ item.avatar }}"
                        alt="{{ item.name|trim ? item.name : 'testimonial-' ~ index }}"
                        class="lazy">
                    </span>
                  </div>
                </footer>
              </article>
            </div>
          {% endfor %}
        </div>
      </salla-slider>
    {% endif %}
  </div>
</section>
