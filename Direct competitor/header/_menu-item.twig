{# 
  ملف: src/views/components/header/_menu-item.twig 
  الوصف: عنصر قائمة واحد (يدعم التكرار)
#}

<li class="nav-item h-full flex items-center relative group/menu {{ menu.has_children ? 'has-children' : '' }}">
    
    {# الرابط الرئيسي #}
    <a href="{{ menu.url }}" {{ menu.link_attrs|raw }} class="text-sm font-bold text-gray-700 hover:text-gold flex items-center gap-1 py-4">
        {{ menu.title }}
        {% if menu.has_children %}
            <i class="sicon-keyboard_arrow_down text-[10px] mt-1"></i>
        {% endif %}
    </a>

    {# القائمة المنسدلة (Cascading Dropdown) #}
    {% if menu.has_children %}
        <div class="cascading-dropdown absolute top-full right-0 w-60 bg-white border border-gray-100 rounded-b-lg shadow-lg py-2 opacity-0 invisible group-hover/menu:opacity-100 group-hover/menu:visible transform translate-y-2 group-hover/menu:translate-y-0 transition-all duration-200 z-40">
            <ul class="flex flex-col">
                {% for submenu in menu.children %}
                    <li class="cascading-item relative group/sub">
                        <a href="{{ submenu.url }}" class="flex items-center justify-between px-5 py-3 text-sm text-gray-600 hover:bg-gray-50 hover:text-gold transition">
                            <div class="flex items-center gap-3">
                                {# محاولة عرض أيقونة إذا كانت متوفرة أو صورة التصنيف #}
                                {% if submenu.image %} 
                                    <img src="{{ submenu.image }}" class="w-5 h-5 object-contain opacity-60 group-hover/sub:opacity-100">
                                {% else %}
                                    {# أيقونة افتراضية للحفاظ على التصميم #}
                                    <i class="sicon-layout-grid text-gray-400 group-hover/sub:text-gold text-lg"></i>
                                {% endif %}
                                <span>{{ submenu.title }}</span>
                            </div>
                            
                            {% if submenu.has_children %}
                                <i class="sicon-keyboard_arrow_left text-[10px] text-gray-400"></i>
                            {% endif %}
                        </a>

                        {# المستوى الثالث (Nested Menu) #}
                        {% if submenu.has_children %}
                            <div class="nested-menu absolute top-0 right-full w-56 bg-white border border-gray-100 rounded-lg shadow-md py-2 mr-1 hidden group-hover/sub:block z-50">
                                <ul>
                                    {% for subsub in submenu.children %}
                                        <li>
                                            <a href="{{ subsub.url }}" class="block px-5 py-2 text-sm text-gray-600 hover:text-gold hover:bg-gray-50">
                                                {{ subsub.title }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</li>